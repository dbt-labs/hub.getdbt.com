<header class="header">
  <%= partial "nav" %>
  <section class="section ensemble center">
	<div class="section-content section-content-small">
      <h1 class="h0">Jumpstart your warehouse</h1>
	  <p class="text-large">
        Use one of our community packages to refine the raw data in your
        warehouse.
	</div>
  </section>
</header>

<main class="main">

  <section class="section offset white">
	<div class="section-content">
	  <div class="row">
          <div class="col-md-12 center">
              <h4 class="h4">Featured Packages</h4>
          </div>
      </div>
      <div class="tiles">
        <% data.featured.each do |feat| %>
            <% org = feat['org'] %>
            <% pkg = feat['package'] %>
            <% name = "#{org}/#{pkg}" %>
            <% package = config[:package_index][name] %>
            <%= partial "package_card", :locals => { :package => package } %>
        <% end %>
      </div>
      <hr/>
      <div class="row">
        <div class="col-md-12 center">
          <h4 class="h4">Package Index</h4>
        </div>
      </div>
      
      <!-- Search and Filter Section -->
      <div class="row" style="margin-top: 30px; margin-bottom: 20px;">
        <div class="col-md-12">
          <div style="max-width: 600px; margin: 0 auto; position: relative;">
            <input 
              type="text" 
              id="package-search" 
              placeholder="Search packages..." 
              style="width: 100%; padding: 12px 40px 12px 16px; font-size: 1rem; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 12px;"
            />
            <button 
              id="clear-search" 
              style="position: absolute; right: 12px; top: 16px; background: none; border: none; font-size: 1.2rem; color: #999; cursor: pointer; padding: 0; display: none; width: 21px; height: 20px; line-height: 1; text-align: center;"
              aria-label="Clear search"
            >×</button>
            <div style="text-align: center;">
              <label style="cursor: pointer; font-size: 0.95rem; display: inline-flex; align-items: center; gap: 8px;">
                <input 
                  type="checkbox" 
                  id="fusion-filter" 
                  style="cursor: pointer; width: 18px; height: 18px;"
                />
                <span>Show only Fusion Conformant packages</span>
              </label>
            </div>
          </div>
        </div>
      </div>
      
      <div id="no-results" style="display: none; text-align: center; padding: 40px; color: #999;">
        <p style="font-size: 1.1rem;">No packages found matching your criteria.</p>
      </div>
      
      <br/>
      <% orgs = data.packages.to_hash.keys.sort_by {|k,v| k.downcase} %>
      <% orgs.each do |org| %>
        <% if not data.blocklist['organizations'].include?(org) %>
          <div class="row package-org" style="margin-top: 40px" data-org="<%= org.downcase %>">
            <div class="col-md-12">
              <h4 class="org-name"><%= org %></h4>
              <ul style="list-style-type: disc; column-width: 250px; list-style-position: inside;">
                   <% packages = data.packages[org].sort_by {|name, package| name.downcase} %>
                   <% packages.each do |name, package| %>
                      <% if not data.blocklist['packages'].include?(org + "/" + name) %>
                          <% full_package = build_package(package, org, name) %>
                          <% is_conformant = is_fusion_conformant(full_package) %>
                          <li class="package-item" 
                              data-package-name="<%= name.downcase %>" 
                              data-full-name="<%= (org + '/' + name).downcase %>"
                              data-fusion-conformant="<%= is_conformant %>">
                              <%= link_to(name, "/#{package['index'].namespace}/#{package['index'].name}/latest") %>
                              <% if is_conformant %>
                                <span style="color: #667eea; font-size: 0.8rem; margin-left: 4px;">✓</span>
                              <% end %>
                          </li>
                      <% end %>
                  <% end %>
              </ul>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </section>
</main>